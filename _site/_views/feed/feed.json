{
  "version": "https://jsonfeed.org/version/1.1",
  "title": "{{{ $app['app.name'] }}}",
  "home_page_url": "{{{ $app['site_url'] }}}",
  "feed_url": "{{{ ($app['site_url'] . $app['base_route'] . $app['route']) }}}",
  "description": "{{{ $app['app.description'] }}}",
  @if( !empty( $app['author'] ) )
  "author": {
    "name": "{{{ $app['author']['name'] ?? '' }}}",
    "email": "{{{ $app['author']['email'] ?? '' }}}",
  },
  @endif
  "items": [
    {% $posts = cockpit('collections')->find('posts', [ 'filter' => [ 'published' => true ], 'sort' => [ '_created' => -1 ] ]); %}
    {% $last  = array_key_last($posts); %}
    @foreach($posts as $key => $post )
      {% $post_url = $app['site_url'] . '/article/' . $post['slug']; %}
      {
        "title": "{{{ (isset($post['title']) ? $post['title'] : '') }}}",
        "date_published": "{{{ \date('c', $post['_created']) }}}",
        "date_modified": "{{{ \date('c', ($post['_modified']) ?? $post['_created']) }}}",
        "id": "{{{ $post_url }}}",
        "url": "{{{ $post_url }}}",
        @if( isset( $post['author'] ) || !empty( $post['author'] ) )
        "author" : {
          "name" : "{{{ $post['author'] ?? $post['author']['name'] }}}"
        },
        @endif
        @if( isset( $post['excerpt'] ) )
          "summary": "{{{ $post['excerpt'] }}}",
        @endif
        @if(!empty($post['tags']))
        "tags": @json( $post['tags'] ),
        @endif
        "content_text": "{{{ strip_tags( $post['content'] ) }}}",
        "content_html": "{{{ $post['content'] }}}"
      }
      @if( $key !== $last )
      ,
      @endif
    @endforeach
  ]
}
